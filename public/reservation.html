<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reservation Page</title>
    <style>
         body, h1, h2, b, p {
    margin: 0;
    padding: 0;
}
        body {
    font-family: Arial, sans-serif;
    background-image: url('media/tubigan.jpg'); 
    background-repeat: no-repeat;
    background-size: cover;
    background-attachment: fixed;
    background-size: cover; 
    background-position: center;
    background-repeat: no-repeat; 
    margin: 0; 
    padding: 0;
    }

    header.style1 {
          display: flex;
          background-color: #007BFF;
          color: #fff;
          text-align: center;
          padding: 5px ;
          
        }
    div.styleRyle {
        padding: 75px 0px 0px 355px;
    }
        header.style1 a {
         display: inline-block;
         background-color: #fff;
         color: #007BFF;
         padding: 10px 150px;
         text-decoration: none;
         border-radius: 5px;
         margin-top: 20px;
         font-weight: bold;
        }
        
        header.style2 {
           background-color: #7cafc9;
           color: #fff;
          text-align: center;
          padding: 5px ;
        }
        header.style2 a {
         display: inline-block;
         background-color: #fff;
         color: #007BFF;
         padding: 10px 20px;
         text-decoration: none;
         border-radius: 5px;
         margin-top: 20px;
         font-weight: bold;
        }
        
	header.style2 nav{
          display: flex;
          justify-content: center;
          align-items: center;
        }
        header.style2 nav a{
            display: inline-block;
          padding: 10px 20px;
          text-decoration: none;
          color: #ff0202;
          background-color: rgb(226, 226, 83);
          border-radius: 35px;
          margin: 0 10px;
          transition: cubic-bezier(0.075, 0.82, 0.165, 1);
        }
        header.style2 nav a:hover{
          background-color: #007BFF;

        }
        header > img {
        height: 200px;
        width: 250px; 
        margin-right: 25px;}

    footer {
         text-align: center;
         background-color: #333;
         color: #fff;
         padding: 0px ;
         margin-top: 200px;
        }

        .btn {
            padding: 10px 30px;
            background-color: #007bff;
            color: #fff;
            text-decoration: none;
            border: none;
            border-radius: 5px;
            margin-top: 5px;
            font-size: 16px;
            cursor: pointer;
        }
    .register-container {
            background-color: #fff;
            border-radius: 18px;
            padding: 45px;
            margin-top: 90px;
            margin-left: 475px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 300px;
        }

        .register-container h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
            
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        .form-group option{
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .bn632-hover {
  width: 160px;
  font-size: 16px;
  font-weight: 600;
  color: #fff;
  cursor: pointer;
  margin: 20px;
  height: 55px;
  text-align:center;
  border: none;
  background-size: 300% 100%;
  border-radius: 50px;
  moz-transition: all .4s ease-in-out;
  -o-transition: all .4s ease-in-out;
  -webkit-transition: all .4s ease-in-out;
  transition: all .4s ease-in-out;
}

.bn632-hover:hover {
  background-position: 100% 0;
  moz-transition: all .4s ease-in-out;
  -o-transition: all .4s ease-in-out;
  -webkit-transition: all .4s ease-in-out;
  transition: all .4s ease-in-out;
}

.bn632-hover:focus {
  outline: none;
}

.bn632-hover.bn26 {
  background-image: linear-gradient(
    to right,
    #25aae1,
    #4481eb,
    #04befe,
    #3f86ed
  );
  box-shadow: 0 4px 15px 0 rgba(65, 132, 234, 0.75);
}

        body {
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding-right: 10px;
            border-radius: 0px;
            backdrop-filter: blur(100%); 
            background-color: rgba(233, 230, 230, 0.8);
            box-shadow: 0 60px 80px rgba(0, 0, 0, 0.1);
            opacity: 100%;
        }
        h1 {
            text-align: center;
        }
        form {
            border: 1px solid #ccc;
            padding: 20px;
            margin-top: 20px;
        }
        
        input, 
        select{
            width: 95%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            
        }
        .smol{
            width: 6.05%;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ccc;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        .hiddenSel{
            visibility: hidden;
            display: none;
            margin-bottom: 0px;
            position: absolute;
        }
        
        input.input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        p{
            margin-right: 10px;
            margin-left: 20px;
        }
        b{
            display:flow-root;
            margin-right:500px;
        }
       
</style>

    
</head>
<body>
    <header class="style1">
        <img src="media/5.png" alt="logo">
    <div class="styleRyle">
      
    </div>   
    </header>
    <header class="style2">
       <nav>  
    <header>
        <a id="lnk1" class="hiddenSel" href="UserPage.html"></a>
        <a href= "Tubigan Garden Resort.html">Home</a>
        <a id="lnk2" href= "LogIn.html">LogIn</a>
        <a href= "Room.html">Rooms</a>
        <a href= "contacts.html">Contact Us</a>
    </nav> </header>
    
    <div class="container">
        <form id="fomres">
            <input type="text" id="resID" name="resID" hidden readonly>
            <label id="l1">Username:</label>
            <input type="text" id="username" name="rescID">
            <label id="l2">Name:</label>
            <input type="text" id="fullname" name="rescName">
            <label id="l3">Email:</label>
            <input type="email" id="email" name="rescEmail" placeholder="Example@gmail.com">
            <label id="l4">Phone Number:</label>
            <input type="number" id="phono" name="rescphono" placeholder="09X-XXXX-XXXX" oninput="javascript: if (this.value.length > 11) this.value = this.value.slice(0, 11);">
            <label id="l7">Total Number of People:</label>
            <input type="number" id="pax" name="resPax" value=1>
            <label id="l8">Number of Children 10 years old and below:</label>
            <input type="number" id="cax" name="resCax" value=0>
            <label>Chosen Room:</label>
            <label id="roomArray"></label>
            <img alt="now you see me" id="selRoomPic" hidden style="width:200px; height:200px;">
            <select id="selRoom" name="resRoomName">
                <option id="default" value=0>Loading. . .</option>
            </select>
            <button type="button" class="btn" onclick="more()">Add More</button>
            <button id="arrayRem" type="button" class="btn" onclick="reduce()">Remove One</button>
            <label id="e"></label>
            <label id="f"></label>
            <label id="l9">Booked Date:  </label>
            <input type="date" id="book-in" name="resBookeDate">
            <label id="l10">Check-In Date:</label>
            <input type="date" id="check-in" name="resCheckDate">
            <label id="l11">Check-out Date:</label>
            <input type="date" id="check-out" name="resBookeDate">
            <label id="l12">Tour Type:</label>
            <select id="selTour" name="resTour">
                <option></option>
                <option>Day Tour</option>
                <option>Night Tour</option>
                <option>Overnight</option>
            </select>
            <input class="smol" type="number" id="daysaf" value=1 min=0 hidden><span id="daysText" hidden>Nights</span>
            <label id="l13">Price</label>
            <input id="price" name="resPrice" value="â‚±300.00" readonly>
            <label id="pricePlus">
                <!--once arrayCount=1, this will display the price the selRoom will be adding due to there being an array-->
            </label>
            <label id="l14">Available Promos:</label>
            <select id="selPromo">
                <option id="default-Promo" value=""></option>
                <!--Oh boy, another one of these-->
            </select>
            <label id="l15">Payment Method:</label>
            <select id="selPayMeth" name="resPayMeth">
                
                <option value="GcashOL" readonly>Gcash - Online</option>
                <option value="GcashOS">Gcash - Onsite</option>
                <option value="Cash">Cash </option>
                <option value="WalkIn">Walk In</option>
            </select>

            
            <button class="btn" type="button" id="addRes" onclick="validator1()">Add Reservation</button>
            <span hidden id="inProgInd" hidden>Processing. Please wait. . .</span>
        </form>
    </div>

    <script>
        const dt=new Date
//#region room Array
let arrayFlag=0,arrayL,indexSel,nu
let arrayPrice=0
const arrayR=[]
const arrayI=[]
const arrayD=[]
function more(){
    document.getElementById('selRoomPic').hidden=true
    arrayR.push(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].textContent)
    arrayD.push({text:document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].textContent,index:arrayI.length})
    document.getElementById('roomArray').innerHTML=arrayD.map(item => `${item.text} <button class="btn" type="button" id="index${item.index}" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`).join('<br>');
    arrayI.push(arrayI.length)
    var nuprice=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value)
    document.getElementById('selRoom').selectedIndex=0
    arrayPrice=parseFloat(arrayPrice)+nuprice
    arrayL=arrayR.length
    if(arrayL>1){
        arrayFlag=1
    }else if(arrayL<=1){
        arrayFlag=0
    }
    document.getElementById('e').innerHTML=`Total Price: ${arrayPrice}`
    //<br> ArrayCount: ${arrayL}<br>${arrayR}<br>${arrayI}<br>Selected Index: ${indexSel}<br>Flag? ${arrayFlag}`
    document.getElementById('f').innerHTML=arrayD.map(item =>`${item.text}- ${item.index}`).join('<br>')
    var x,y,z
    if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
    var disPrice=parseFloat((x-y)+z)+parseFloat(arrayPrice)
    document.getElementById('price').value=disPrice.toFixed(2)
    document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value}`
}

function selectIndex(index){
    console.log(indexSel)
    console.log(index)
    if (indexSel !== undefined) {
        document.getElementById(`index${indexSel}`).style.backgroundColor = "#007BFF";
    }
    if(indexSel==index){
    indexSel=undefined
    console.log("Selected: "+indexSel)
    document.getElementById('arrayRem').onclick=reduce
    }else{
        indexSel=index
    console.log("Selected: "+indexSel)
        document.getElementById(`index${indexSel}`).style.backgroundColor="#eb2222"
        document.getElementById('arrayRem').onclick=deletArray
    }
}

function deletArray(){
    document.getElementById('selRoomPic').hidden=true
    console.log(indexSel)
    if(indexSel!=-1){
        arrayD.splice(indexSel,1);
        var a=arrayR.splice(indexSel,1)
        arrayI.pop();
        arrayL=arrayR.length
        for(let i=0; i<arrayD.length;i++){
            arrayD[i].index=i
        }
        const selA=document.getElementById('selRoom')
    for(let i=0; i<selA.options.length; i++){
        //alert(selA.options[i].text + " = "+ a)
                if(selA.options[i].text==a){
                    selA.selectedIndex=i
                    break;
                }
               }
               var nuprice=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value)
    arrayPrice=parseFloat(arrayPrice)-parseFloat(nuprice)
   // alert(arrayPrice)
    arrayL=arrayR.length
    if(arrayL>1){
        arrayFlag=1
    }else if(arrayL<=1){
        arrayFlag=0
    }
    document.getElementById('selRoom').selectedIndex=0
        document.getElementById('roomArray').innerHTML=arrayD.map(item => `${item.text} <button class="btn" type="button" id="index${item.index}" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`).join('<br>');
        document.getElementById('e').innerHTML=`Total Price: ${arrayPrice}`
        // <br> ArrayCount: ${arrayL}<br>${arrayR}<br>${arrayI}<br>Selected Index: ${indexSel}<br>Flag? ${arrayFlag}`
        document.getElementById('f').innerHTML=arrayD.map(item =>`${item.text}- ${item.index}`).join('<br>')
        var x,y,z
    if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
           var disPrice=parseFloat((x-y)+z)+parseFloat(arrayPrice)
           //alert(arrayPrice+" "+disPrice)
    document.getElementById('price').value=disPrice.toFixed(2)
    document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value}`
    indexSel=nu
    document.getElementById('arrayRem').onclick=reduce
    }
    
}


function reduce(){
    document.getElementById('selRoomPic').hidden=true
    console.log(indexSel)
    if(arrayR.length===0){
        return
    }
    var a=arrayR.pop()
    arrayI.pop()
    arrayD.pop()
    document.getElementById('roomArray').innerHTML=`${arrayR.join(`<br>`)}`
    document.getElementById('roomArray').innerHTML=arrayD.map(item => `${item.text} <button class="btn" type="button" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`).join('<br>');
    const selA=document.getElementById('selRoom')
    for(let i=0; i<selA.options.length; i++){
                if(selA.options[i].text===a){
                    selA.selectedIndex=i
                    break;
                }
               }
    var nuprice=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value)
    document.getElementById('selRoom').selectedIndex=0
    arrayPrice=parseFloat(arrayPrice)-nuprice
    arrayL=arrayR.length
    if(arrayL>1){
        arrayFlag=1
    }else if(arrayL<=1){
        arrayFlag=0
    }
    document.getElementById('e').innerHTML=`Total Price: ${arrayPrice}`
    // <br> ArrayCount: ${arrayL}<br>${arrayR}<br>${arrayI}<br>Selected Index: ${indexSel}<br>Flag? ${arrayFlag}`
    document.getElementById('f').innerHTML=arrayD.map(item =>`${item.text}- ${item.index}`).join('<br>')
    var x,y,z
    if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
           var disPrice=parseFloat((x-y)+z)+parseFloat(arrayPrice)
    document.getElementById('price').value=disPrice.toFixed(2)
    document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value}`
    }

//#endregion

//#region how am I supposed to reserve a room without PICTURES???

document.getElementById('selRoom').addEventListener('change', async function() {
    let room=document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].textContent
    console.log(room)
    try {
        const response = await fetch('/room-data');
        const result = await response.json();
        if (response.ok) {
            for(let item of result){
                let roomName=item.roomName
                console.log(roomName)
                if(room==roomName){
                    document.getElementById('selRoomPic').hidden=false
    document.getElementById('selRoomPic').src=item.roomImg
                }
            }
        }}
    catch(err) {
        console.error('Error:', err);
    }
    //it grabs the appropriate picture's url from the database and slaps it onto the img's src.
})

//#endregion

//#region price manipulator
    document.getElementById('selRoom').addEventListener('change', function() {
        const selectedOption = parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           const price=document.getElementById('price');
           var x,y;
           if(arrayL==undefined || arrayL==0){
            if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
           } 
           var nuPrice=((x+selectedOption)-y)+arrayPrice;
           price.value=nuPrice.toFixed(2);
           if (document.getElementById('selRoom').value==""){
            price.value="300"
           }
           }else{
            if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
           } 
           var nuPrice=(x-y)+arrayPrice;
           price.value=nuPrice.toFixed(2);
           document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value}`
           if (document.getElementById('selRoom').value==""){
            document.getElementById('pricePlus').textContent="0"
           }
           }
        });

        document.getElementById('pax').addEventListener('change',function(){
            if(document.getElementById('pax').value <=0){
                document.getElementById('pax').value=1
            }
            const priceText=document.getElementById('price');
            var x,y,z;
            if(arrayL==undefined || arrayL==0){
                if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } 
           if(x<y){
            document.getElementById('cax').value=document.getElementById('pax').value
           }else if(x==y){
            document.getElementById('cax').value=document.getElementById('cax').value-1
            if( document.getElementById('cax').value <=0){
                document.getElementById('cax').value=0
            }
           }else{
            var nuPrice=((x-y)+z)+arrayPrice;
           priceText.value=nuPrice.toFixed(2);
           }
            }else{
                //if array is 1, cuz there's gonna be more
                if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } 
           if(x<y){
            document.getElementById('cax').value=document.getElementById('pax').value
           }else if(x==y){
            document.getElementById('cax').value=document.getElementById('cax').value-1
            if( document.getElementById('cax').value <=0){
                document.getElementById('cax').value=0
            }
           }else{
            var nuPrice=(x-y)+arrayPrice;
           priceText.value=nuPrice.toFixed(2);
           document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value}`
           }
            }
        });

        document.getElementById('cax').addEventListener('change',function(){
            if( document.getElementById('cax').value <=0){
                document.getElementById('cax').value=0
            }
            const priceText=document.getElementById('price');
            var x,y,z;
            if(arrayL==undefined || arrayL==0){
                if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } 
           if(x<y){
            document.getElementById('cax').value=document.getElementById('pax').value
           }else if(x==y){
            document.getElementById('cax').value=document.getElementById('cax').value-1
            if( document.getElementById('cax').value <=0){
                document.getElementById('cax').value=0
            }
           }else{
            var nuPrice=((x-y)+z)+arrayPrice;
           priceText.value=nuPrice.toFixed(2);
           }
            }else{
                //arrayCount is 1, and there's gonna be more
                if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
           } 
           if(x<y){
            document.getElementById('cax').value=document.getElementById('pax').value
           }else if(x==y){
            document.getElementById('cax').value=document.getElementById('cax').value-1
            if( document.getElementById('cax').value <=0){
                document.getElementById('cax').value=0
            }
           }else{
            var nuPrice=(x-y)+arrayPrice;
           priceText.value=nuPrice.toFixed(2);
           document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value}`
           }
            }
        });      


fetch(`/current_Mem`).then(response=>{
    if(response.ok){
        return response.json()
    }else {
    }
  })
  .then(data =>{
    const r1=document.getElementById('username')
    const rl1=document.getElementById('l1');
    rl1.textContent="Username: "+data.mID
    r1.readOnly=true;
    r1.value=data.mID;
    r1.hidden=true;
    const r2=document.getElementById('fullname')
    const rl2=document.getElementById('l2');
    rl2.textContent="Name: "+data.mName
    r2.readOnly=true;
    r2.value=data.mName
    r2.hidden=true;
    const r3=document.getElementById('email')
    const rl3=document.getElementById('l3');
    rl3.textContent="Email: "+data.mEmail
    r3.readOnly=true
    r3.value=data.mEmail
    r3.hidden=true;
    const r4=document.getElementById('phono')
    const rl4=document.getElementById('l4');
    rl4.textContent="Phone Number: "+data.mPhoNo
    r4.readOnly=true
    r4.value=data.mPhoNo
    r4.hidden=true;
    document.getElementById('lnk1').classList.remove('hiddenSel')
    document.getElementById('lnk1').style="background-color: orange"
    document.getElementById('lnk1').textContent=data.mID
    document.getElementById('lnk2').textContent="Log Out"
})

let primeResPrice,primeCax,primePax,idplus,payPicked,idFlag,ameWan;


fetch('/promo-data').then(response=>{
        if (response.ok){
            return response.json()
        }else{
            throw new Error('Error fetching data');
        }
    }).then(data=>{
        const selectE=document.getElementById('selPromo')
        document.getElementById("default-Promo")
        data.forEach(item=>{
            const option=document.createElement('option')
            option.value=item.proName
            option.textContent=item.proName
            selectE.appendChild(option)
        })
    }).catch(error => {
    console.error('Error fetching data:', error);
  });         

//#endregion
//#region data fill-er-upper
        fetch('/room-data')
            .then(response => {
                if (response.ok) {
                    return response.json(); 
                } else {
                    throw new Error('Error fetching data');
                }
            })
            .then(data => {
                const selectElement = document.getElementById('selRoom');
                document.getElementById('default').textContent = "";
                data.forEach(item => {
                    if(item.roomReservd!="Unavailable"){
                        const option = document.createElement('option');
                    option.value = item.roomCost; 
                    option.textContent = item.roomName;
                    selectElement.appendChild(option);
                    }
                });
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
//#endregion

//#region days away from checkin to bookin
document.getElementById('book-in').addEventListener('change',function(){
const tour=document.getElementById('selTour')
var days=parseInt(document.getElementById('daysaf').value);
const checkedA=new Date(document.getElementById('book-in').value)
var today = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate()+1);
console.log(checkedA)
console.log(today)
console.log(checkedA>today.getDate())
if(checkedA>today.getDate()){
    checkedA.setDate(today.getDate())
    document.getElementById('book-in').valueAsDate=checkedA
}

if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value=="WalkIn"){
                checkedA.setDate(checkedA.getDate()+days)
}else{
                checkedA.setDate(checkedA.getDate()+1+days)
            }

const checkedB=new Date(document.getElementById('book-in').value)

if(document.getElementById('check-in').valueAsDate<document.getElementById('book-in').valueAsDate){
                document.getElementById('check-in').valueAsDate=document.getElementById('book-in').valueAsDate
                document.getElementById('check-out').valueAsDate=document.getElementById('book-in').valueAsDate
if(tour.options[tour.selectedIndex].textContent!==""){
    if(tour.options[tour.selectedIndex].textContent=="Day Tour"){
        document.getElementById('check-out').valueAsDate=checkedA
        document.getElementById('check-in').valueAsDate=checkedB
    }else if(tour.options[tour.selectedIndex].textContent=="Night Tour"){
        document.getElementById('check-out').valueAsDate=checkedA
        document.getElementById('check-in').valueAsDate=checkedB
    }else if(tour.options[tour.selectedIndex].textContent=="Overnight"){
        document.getElementById('check-in').valueAsDate=checkedB
    }
    
}
if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value!="WalkIn"){
    document.getElementById('check-out').valueAsDate=checkedA
    checkedB.setDate(checkedB.getDate()+1)
    document.getElementById('check-in').valueAsDate=checkedB
}
}else if(document.getElementById('check-in').valueAsDate>document.getElementById('book-in').valueAsDate){
    if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value=="WalkIn"){
        document.getElementById('check-in').valueAsDate=document.getElementById('book-in').valueAsDate
                document.getElementById('check-out').valueAsDate=document.getElementById('book-in').valueAsDate
    }else{
        return
    }
}

if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value=="WalkIn"){
                checkedB.setDate(checkedB.getDate())
}else{
                checkedB.setDate(checkedB.getDate()+1)
}

if(tour.options[tour.selectedIndex].textContent!==""){
    document.getElementById('check-out').valueAsDate=checkedA
    document.getElementById('check-in').valueAsDate=checkedB
}
})
//post book-in

document.getElementById('check-in').addEventListener('change',function(){
    const tour=document.getElementById('selTour')
    var days=parseInt(document.getElementById('daysaf').value);
            const checkedA=new Date(document.getElementById('check-in').value)
            const checkedB=new Date(document.getElementById('check-in').value)
            
            if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value=="WalkIn"){
                checkedB.setDate(checkedB.getDate())
                checkedA.setDate(checkedA.getDate()+days)
            }else{
                const checkedCA=new Date(document.getElementById('check-in').value)
                const checkedCB=new Date(document.getElementById('book-in').value)
                if(checkedCA.getDate()>checkedCB.getDate()){
                    checkedA.setDate(checkedA.getDate()+days)
                    checkedB.setDate(checkedCB.getDate())
                }else if(checkedCA.getDate()<=checkedCB.getDate()){
                    checkedA.setDate(checkedA.getDate()+days)
                    checkedB.setDate(checkedB.getDate()-1)
                }
            }
            
        const checkedAB=new Date(document.getElementById('check-out').value)
        const checkedAC=checkedAB.getDate()-checkedA.getDate()
        if(tour.options[tour.selectedIndex].text=="Overnight"){
            if(checkedAC>days){
            days=checkedAC
            document.getElementById('daysaf').value=(days+1)
            checkedA.setDate(checkedA.getDate()+days)
        }
        }
        
            document.getElementById('check-out').valueAsDate=checkedA
            document.getElementById('book-in').valueAsDate =checkedB
        })

document.getElementById('check-out').addEventListener('change',function(){
    const tour=document.getElementById('selTour')
    const payM=document.getElementById('selPayMeth')
    var days=parseInt(document.getElementById('daysaf').value);
    const checkedA=new Date(document.getElementById('check-out').value)
    checkedA.setDate(checkedA.getDate()-days)
    const checkedB=new Date(document.getElementById('check-out').value)
    checkedB.setDate(checkedB.getDate()-days-1)
    const checkedAB=new Date(document.getElementById('check-in').value)
    const checkedAC=checkedA.getDate()-checkedAB.getDate()
    console.log(checkedA)
    console.log(checkedAB)
    console.log(checkedAC)

    if(tour.options[tour.selectedIndex].text=="Overnight"){
            console.log(days)
            if(checkedAC>days){
            days=checkedAC+days
            console.log(days)
            document.getElementById('daysaf').value=days
            console.log(checkedA)
            const checkedC=new Date(document.getElementById('check-out').value)
            checkedA.setDate(checkedC.getDate()-days)
            console.log(checkedA)
            checkedB.setDate(checkedC.getDate()-days-1)   
            }else{
                console.log(days)
                document.getElementById('daysaf').value=days
            }
            
    }else if(tour.options[tour.selectedIndex].text=="Night Tour"){
        checkedA.setDate(checkedA.getDate()-days)
            console.log(checkedA)
    }
    if(payM.options[payM.selectedIndex].text=="Walk In"){
        const checkedC=document.getElementById('check-in').valueAsDate
        checkedB.setDate(checkedC.getDate())
    }
    document.getElementById('check-in').valueAsDate=checkedA
    document.getElementById('book-in').valueAsDate=checkedB
})

document.getElementById('daysaf').addEventListener('change',function(){
            var days=parseInt(document.getElementById('daysaf').value);
            const checkedA=new Date(document.getElementById('check-in').value)
            checkedA.setDate(checkedA.getDate()+days)

            const checkedB=new Date(document.getElementById('check-in').value)
            if(document.getElementById('check-in').valueAsDate<document.getElementById('book-in').valueAsDate){
                checkedB.setDate(document.getElementById('book-in').valueAsDate.getDate())
            }
            
            if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value=="WalkIn"){
                checkedB.setDate(checkedB.getDate())
            }else{
                const checkedCA=new Date(document.getElementById('check-in').value)
                const checkedCB=new Date(document.getElementById('book-in').value)
                if(checkedCA.getDate()>checkedCB.getDate()){
                    checkedB.setDate(checkedCB.getDate())
                }else if(checkedCA.getDate()<=checkedCB.getDate()){
                    checkedB.setDate(checkedB.getDate()-1)
                }
            }
            if(document.getElementById('check-in').value==""){

            }else{
                document.getElementById('check-out').valueAsDate=checkedA
                document.getElementById('book-in').valueAsDate = checkedB
            }
        })

document.getElementById('selPayMeth').addEventListener('change',function(){
if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value=="WalkIn"){
    document.getElementById('book-in').valueAsDate=document.getElementById('check-in').valueAsDate
}else{
    if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value=="WalkIn"){
        document.getElementById('book-in').valueAsDate=document.getElementById('check-in').valueAsDate
    }else{
        const checkedA=new Date(document.getElementById('check-in').value)
        const checkedB=new Date(document.getElementById('book-in').value)
       if(checkedA.getDate()>checkedB.getDate()){
        return
       }else if(checkedA.getDate()<=checkedB.getDate()){
        checkedA.setDate(checkedA.getDate()-1)
        document.getElementById('book-in').valueAsDate=checkedA
       } 
    }
}
})
//#endregion

//#region tours
document.getElementById('selTour').addEventListener('change',function(){
    if(document.getElementById('selTour').value=="Overnight"){
        document.getElementById('daysaf').hidden=false
        document.getElementById('l11').textContent="Check-out Date:  "
        document.getElementById('daysText').hidden=false
        document.getElementById('check-out').hidden=false
            document.getElementById('daysaf').value=1
        const checkedA=new Date(document.getElementById('check-in').value)
        checkedA.setDate(checkedA.getDate()+1)
        document.getElementById('check-out').valueAsDate=checkedA
        document.getElementById('daysaf').readOnly=false
    }else if(document.getElementById('selTour').value=="Day Tour"){
        document.getElementById('daysaf').hidden=false
        document.getElementById('daysText').hidden=false
        document.getElementById('daysaf').value=0
        document.getElementById('check-out').valueAsDate=document.getElementById('check-in').valueAsDate
        const checkedA=new Date(document.getElementById('check-in').value)
        checkedA.setDate(checkedA.getDate()-1)
        document.getElementById('book-in').valueAsDate=checkedA
        document.getElementById('daysaf').readOnly=true
    }else if(document.getElementById('selTour').value=="Night Tour"){
        document.getElementById('daysaf').hidden=false
        document.getElementById('daysText').hidden=false
        document.getElementById('daysaf').value=1
        const checkedA=new Date(document.getElementById('check-in').value)
        checkedA.setDate(checkedA.getDate()+1)
        document.getElementById('check-out').valueAsDate=checkedA
        document.getElementById('daysaf').readOnly=true
    }
    if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value=="WalkIn"){
        document.getElementById('book-in').valueAsDate=document.getElementById('check-in').valueAsDate
    }
})
//#endregion


let payGo=0;
let conflict
async function validator1(){
    document.getElementById('inProgInd').hidden=false;
            await searchRA()
            if(emptyFlag==true && sameDateFlag==true){
                conflict=`there being a conflict with the Schedule in regards to Roomnity ${ameE}`
            }
            else if(sameDateFlag==true){
                conflict="there being a conflict with the Schedule"
            }else if(emptyFlag==true && sameFlag==true){
                conflict=`no more available instances of ${ameE}`
            }
            if(conflict!=null){
                alert(`Unable to proceed due to ${conflict}.`)
                document.getElementById('inProgInd').hidden=true;
            }else{
                if(arrayFlag==0){
        if(arrayL==1){
        const a=arrayR[0]
        alert(a)
        const selA=document.getElementById('selRoom')
        for(let i=0; i<selA.options.length; i++){
            if(selA.options[i].text==a){
                selA.selectedIndex=i
                break;
                }
            }   
        }
        return validator2A()
    }else{
        return validator2B()
    }
            }
}

async function validator2A(){
            const ID=document.getElementById('resID');
            const rescID = document.getElementById('username');
            const rescName = document.getElementById('fullname');
            const resPax=document.getElementById('pax');
            const resCax=document.getElementById('cax');
            const resRoomName=document.getElementById('selRoom');
            const resCheckinDate=document.getElementById('check-in');
            const resTour=document.getElementById('selTour');
            const resPayMeth=document.getElementById('selPayMeth');
            const rescEmail=document.getElementById('email');
            const rescphono=document.getElementById('phono');
            const rescBookeDate=document.getElementById('book-in');
            const resCheckoutDate=document.getElementById('check-out')
                if(rescID.value==""||rescName.value==""||resPax.value==""||resCax.value==""||resRoomName.value==""||resCheckinDate.value==""||resCheckoutDate.value==""||resTour.value==""||resPayMeth.value==""||rescphono.value==""||rescEmail.value==""||rescBookeDate.value==""){
                alert("Please fill all the transaction details fields.");
                document.getElementById('inProgInd').hidden=true;
            }else{
                var today = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate()+1);
                if(resCheckinDate.valueAsDate >= today){}else{
                    document.getElementById('inProgInd').hidden=true;
                    return alert("Please set the date of schedule, that is earlier than that.")
                }
                    if(resPayMeth.value==="GcashOL"){
                    const confirmation=confirm("Would you like to pay now?");
                    if(confirmation){
                        const date = resCheckinDate.valueAsDate.toLocaleDateString('en-US', { year: '2-digit', month: '2-digit', day: '2-digit' }).replace(/\//g, '');
                        const rng=Math.floor(Math.random()*10);
                        const rng2=Math.floor(Math.random()*10);
                        const rng3=Math.floor(Math.random()*10);
                        const rng4=Math.floor(Math.random()*10);
                        ID.value=rescID.value[0]+rescName.value[0]+"-"+rng+rng2+rng3+rng4+"-"+date
                        payGo=1;
                        return insertRes()
                    }else{
                        alert("Please do not forget to forward the payment to GCash Number: 09X-XXXX-XXXX. Otherwise, you can visit Tubigan Garden Resort to pay for the reservation.")
                        const dt = resCheckinDate.valueAsDate.toLocaleDateString('en-US', { year: '2-digit', month: '2-digit', day: '2-digit' }).replace(/\//g, '');
                        const rng=Math.floor(Math.random()*10);
                        const rng2=Math.floor(Math.random()*10);
                        const rng3=Math.floor(Math.random()*10);
                        const rng4=Math.floor(Math.random()*10);
                        ID.value=rescID.value[0]+rescName.value[0]+"-"+rng+rng2+rng3+rng4+"-"+dt
                        notifier();
                        await notifierCust();
                        payPicked="Unpaid"
                        insertRes()
                    }
                }else if(resPayMeth.value==="WalkIn"){
                    const confirmation=confirm("Would you like to pay now?");
                    if(confirmation){
                        const date = resCheckinDate.valueAsDate.toLocaleDateString('en-US', { year: '2-digit', month: '2-digit', day: '2-digit' }).replace(/\//g, '');
                        const rng=Math.floor(Math.random()*10);
                        const rng2=Math.floor(Math.random()*10);
                        const rng3=Math.floor(Math.random()*10);
                        const rng4=Math.floor(Math.random()*10);
                        ID.value=rescID.value[0]+rescName.value[0]+"-"+rng+rng2+rng3+rng4+"-"+date
                        payGo=1;
                        insertRes()
                    }else{
                        alert("Please provide the exact amount for your payment, when visiting us on your reservation. See you soon!")
                        const date = resCheckinDate.valueAsDate.toLocaleDateString('en-US', { year: '2-digit', month: '2-digit', day: '2-digit' }).replace(/\//g, '');
                        ID.value=rescID.value[0]+rescName.value[0]+date
                        notifier();
                        await notifierCust();
                        payPicked="Unpaid"
                        insertRes()
                    }
                }else{
                        alert(`Please do not forget to visit Tubigan Garden resort on or before ${rescBookeDate.valueAsDate} to settle your payments. Thank you!`)
                        const dt = resCheckinDate.valueAsDate.toLocaleDateString('en-US', { year: '2-digit', month: '2-digit', day: '2-digit' }).replace(/\//g, '');
                        const rng=Math.floor(Math.random()*10);
                        const rng2=Math.floor(Math.random()*10);
                        const rng3=Math.floor(Math.random()*10);
                        const rng4=Math.floor(Math.random()*10);
                        ID.value=rescID.value[0]+rescName.value[0]+"-"+rng+rng2+rng3+rng4+"-"+dt
                        payPicked="Unpaid"
                        return insertRes();
                }
                
            }
            }

async function validator2B(){
    const ID=document.getElementById('resID');
            const rescID = document.getElementById('username');
            const rescName = document.getElementById('fullname');
            const resPax=document.getElementById('pax');
            const resCax=document.getElementById('cax');
            const resRoomName=document.getElementById('selRoom');
            const resCheckinDate=document.getElementById('check-in');
            const resTour=document.getElementById('selTour');
            const resPayMeth=document.getElementById('selPayMeth');
            const rescEmail=document.getElementById('email');
            const rescphono=document.getElementById('phono');
            const rescBookeDate=document.getElementById('book-in');
            const resCheckoutDate=document.getElementById('check-out')
    if(rescID.value==""||rescName.value==""||resPax.value==""||resCax.value==""||resCheckinDate.value==""||resCheckoutDate.value==""||resTour.value==""||resPayMeth.value==""||rescphono.value==""||rescEmail.value==""||rescBookeDate.value==""){
        document.getElementById('inProgInd').hidden=true;
                return alert("Please fill all the transaction details fields.");
            }else{
                var today = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate()+1);
                if(resCheckinDate.valueAsDate >= today){}else{
                    alert("Please set the date of schedule, that is earlier than that.")
                    document.getElementById('inProgInd').hidden=true;
                }
                    if(resPayMeth.value==="GcashOL"){
                    const confirmation=confirm("Would you like to pay now?");
                    if(confirmation){
                        const date = resCheckinDate.valueAsDate.toLocaleDateString('en-US', { year: '2-digit', month: '2-digit', day: '2-digit' }).replace(/\//g, '');
                        const rng=Math.floor(Math.random()*10);
                        const rng2=Math.floor(Math.random()*10);
                        const rng3=Math.floor(Math.random()*10);
                        const rng4=Math.floor(Math.random()*10);
                        ID.value=rescID.value[0]+rescName.value[0]+"-"+rng+rng2+rng3+rng4+"-"+date
                        payGo=1;
                        insertRes()
                    }else{
                        alert("Please do not forget to forward the payment to GCash Number: 09X-XXXX-XXXX. Otherwise, you can visit Tubigan Garden Resort to pay for the reservation.")
                        const date = resCheckinDate.valueAsDate.toLocaleDateString('en-US', { year: '2-digit', month: '2-digit', day: '2-digit' }).replace(/\//g, '');
                        const rng=Math.floor(Math.random()*10);
                        const rng2=Math.floor(Math.random()*10);
                        const rng3=Math.floor(Math.random()*10);
                        const rng4=Math.floor(Math.random()*10);
                        ID.value=rescID.value[0]+rescName.value[0]+"-"+rng+rng2+rng3+rng4+"-"+date
                        notifier();
                        payPicked="Unpaid"
                        await notifierCust();
                        insertRes()
                    }
                }else if(resPayMeth.value==="WalkIn"){
                    const confirmation=confirm("Would you like to pay now?");
                    if(confirmation){
                        const date = resCheckinDate.valueAsDate.toLocaleDateString('en-US', { year: '2-digit', month: '2-digit', day: '2-digit' }).replace(/\//g, '');
                        const rng=Math.floor(Math.random()*10);
                        const rng2=Math.floor(Math.random()*10);
                        const rng3=Math.floor(Math.random()*10);
                        const rng4=Math.floor(Math.random()*10);
                        ID.value=rescID.value[0]+rescName.value[0]+"-"+rng+rng2+rng3+rng4+"-"+date
                        payGo=1;
                        insertRes()
                    }else{
                        alert("Please provide the exact amount for your payment, when visiting us on your reservation. See you soon!")
                        const date = resCheckinDate.valueAsDate.toLocaleDateString('en-US', { year: '2-digit', month: '2-digit', day: '2-digit' }).replace(/\//g, '');
                        const rng=Math.floor(Math.random()*10);
                        const rng2=Math.floor(Math.random()*10);
                        const rng3=Math.floor(Math.random()*10);
                        const rng4=Math.floor(Math.random()*10);
                        ID.value=rescID.value[0]+rescName.value[0]+"-"+rng+rng2+rng3+rng4+"-"+date
                        payPicked="Unpaid"
                        notifier();
                        await notifierCust();
                        return insertRes();
                    }
                }else{
                        alert(`Please do not forget to visit Tubigan Garden resort on or before ${rescBookeDate.valueAsDate} to settle your payments.Thank you!`)
                        const date = resCheckinDate.valueAsDate.toLocaleDateString('en-US', { year: '2-digit', month: '2-digit', day: '2-digit' }).replace(/\//g, '');
                        const rng=Math.floor(Math.random()*10);
                        const rng2=Math.floor(Math.random()*10);
                        const rng3=Math.floor(Math.random()*10);
                        const rng4=Math.floor(Math.random()*10);
                        ID.value=rescID.value[0]+rescName.value[0]+"-"+rng+rng2+rng3+rng4+"-"+date
                        payPicked="Unpaid"
                        return insertRes();
                }
                
            }
}

let sameFlag,ameE,sameDateFlag,emptyFlag,diffResFlag
async function searchRA() {
    if(arrayFlag!=1){
        const ameI = document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].text;
        const ameResI=document.getElementById("username").value
    try {
        const response = await fetch('/room-data');
        const result = await response.json();
        if (response.ok) {
            for (const item of result) {
                const pax=document.getElementById('pax').value
                if(pax>item.roomSize){
                    alert("The number of people has exceeded its limit; this room cannot accommodate all of you")
                    return conflict="exceeding size capacity"
                    break;
                }
                const ame = item.roomName;
                const motoRes = await fetch(`/searchResRoom?resRoomName=${ame}`);
                const zuttoRes = await motoRes.json();
                if (motoRes.ok && Array.isArray(zuttoRes.data)) {
                    for (const res of zuttoRes.data) {
                        const ameF = res.resRoomName;
                        const checkF = res.resCheckinDate;
                        const ameResdF=res.rescIDf
                        console.log(ameF + " " + ame + " "+ ameI)
                        if (ameF == ame && ame == ameI && ameResI!=ameResdF){
                            sameFlag = true;
                            ameS = ameF;
                            diffResFlag=true
                            const checkI = document.getElementById('check-in').value;
                            if (checkF==checkI) {
                                sameDateFlag = true;
                            }
                        }
                    }
                }else if(motoRes.ok && !Array.isArray(zuttoRes.data)){
                    const ameF = zuttoRes.resRoomName;
                        const checkF = zuttoRes.resCheckinDate;
                        console.log(ameF + " " + ame + " "+ ameI)
                        if (ameF == ame && ame == ameI) {
                            sameFlag = true;
                            ameS = ameF;
                            const checkI = document.getElementById('check-in').value;
                            if (checkF == checkI) {
                                sameDateFlag = true;
                            }
                        }
                }

                if (ameI == ame && item.roomLeft == 0) {
                    emptyFlag = true;
                    ameE = ameI;
                }
            }
            console.log("Empty Flag:"+emptyFlag)
            console.log("Same Flag:"+sameFlag)
            console.log("Same Date Flag:"+sameDateFlag)
            console.log("Different Guy:"+diffResFlag)
        } else {
            console.error('Response not okay:', response.statusText);
        }
    } catch (err) {
        console.error('Error:', err);
    }
    }
    else
    {
        let roomSizeStack=0;
        for(let i=0; i<arrayR.length;i++){
            const ameI = arrayR[i]
        const ameResI=document.getElementById("username").value
    try {
        const response = await fetch('/room-data');
        const result = await response.json();

        if (response.ok) {
            for (const item of result) {
                roomSizeStack=roomSizeStack+parseInt(item.roomSize)
                console.log(roomSizeStack)
                const pax=document.getElementById('pax').value
                if(roomSizeStack!=0 && pax>roomSizeStack){
                    alert("The number of people has exceeded its limit; this room cannot accommodate all of you")
                    return conflict="exceeding size capacity"
                    break;
                }
                const ame = item.roomName;
                const motoRes = await fetch(`/searchResRoom?resRoomName=${ame}`);
                const zuttoRes = await motoRes.json();
                if (motoRes.ok && Array.isArray(zuttoRes.data)) {
                    for (const res of zuttoRes.data) {
                        const ameF = res.resRoomName;
                        const checkF = res.resCheckinDate;
                        const ameResdF=res.rescIDf
                        console.log(ameF + " " + ame + " "+ ameI)
                        if (ameF == ame && ame == ameI && ameResI!=ameResdF){
                            sameFlag = true;
                            ameS = ameF;
                            diffResFlag=true
                            const checkI = document.getElementById('check-in').value;
                            if (checkF==checkI) {
                                sameDateFlag = true;
                            }
                        }
                    }
                }else if(motoRes.ok && !Array.isArray(zuttoRes.data)){
                    const ameF = zuttoRes.resRoomName;
                        const checkF = zuttoRes.resCheckinDate;
                        console.log(ameF + " " + ame + " "+ ameI)
                        if (ameF == ame && ame == ameI) {
                            sameFlag = true;
                            ameS = ameF;
                            const checkI = document.getElementById('check-in').value;
                            if (checkF == checkI) {
                                sameDateFlag = true;
                            }
                        }
                }

                if (ameI == ame && item.roomLeft == 0) {
                    emptyFlag = true;
                    ameE = ameI;
                }
            }
            console.log("Empty Flag:"+emptyFlag)
            console.log("Same Flag:"+sameFlag)
            console.log("Same Date Flag:"+sameDateFlag)
            console.log("Different Guy:"+diffResFlag)
        } else {
            console.error('Response not okay:', response.statusText);
        }
    } catch (err) {
        console.error('Error:', err);
    }
        }
    }
    
}


async function updateRoom(){
    if(arrayFlag!=1){
        const roomName=document.getElementById('selRoom').options[selRoom.selectedIndex].textContent;
        if(roomName !=""){
            let roomCostf,roomSizef,roomReservdf,roomLeftf
        try{
            const response=await fetch(`/searchRoom?roomName=${roomName}`);
            const result=await response.json();
            if(response.ok){
                roomCostf=result.roomCost
                roomSizef=result.roomSize
                roomReservdf=result.roomReservd
                roomLeftf=result.roomLeft
            }else{
                alert("E-E-ERROR! ",result.error);
            }
        }catch(err){
            console.error("Error looking through the Database. ",err);
            alert('someone tripped over the wires!');
        }
        const roomLeftI=roomLeftf-1
        let roomResI=roomReservdf
        if(roomLeftI==0){
            roomResI="Unavailable"
        }
        if(roomLeftI>=0){
            const up={
            roomName:roomName,
            roomSize:roomSizef,
            roomCost:roomCostf,
            roomReservd:roomResI,
            roomLeft:roomLeftI
        }
        try{
            const response = await fetch('/updateRoom',{
            method:'PATCH',
            headers:{
                'Content-Type':'application/json'
            },
            body:JSON.stringify(up),
            });
            const result=await response.json();
            if (response.ok){
                console.log("success")
                
            }else{
                alert(result.error);
            }
        }catch(err){
            console.error('E-E-ERROR! ',err);
            alert('An Error Occured While Inserting The Record.');
        }
        }
        }else{
            alert("Please input what to update.");
        }
    }else{
        for(let i=0; i<arrayR.length;i++){
            const roomName=arrayR[i]
        if(roomName !=""){
            let roomCostf,roomSizef,roomReservdf,roomLeftf
        try{
            const response=await fetch(`/searchRoom?roomName=${roomName}`);
            const result=await response.json();
            if(response.ok){
                roomCostf=result.roomCost
                roomSizef=result.roomSize
                roomReservdf=result.roomReservd
                roomLeftf=result.roomLeft
            }else{
                alert("E-E-ERROR! ",result.error);
            }
        }catch(err){
            console.error("Error looking through the Database. ",err);
            alert('someone tripped over the wires!');
        }
        const roomLeftI=roomLeftf-1
        let roomResI=roomReservdf
        if(roomLeftI==0){
            roomResI="Unavailable"
        }
        if(roomLeftI>=0){
            const up={
            roomName:roomName,
            roomSize:roomSizef,
            roomCost:roomCostf,
            roomReservd:roomResI,
            roomLeft:roomLeftI
        }
        try{
            const response = await fetch('/updateRoom',{
            method:'PATCH',
            headers:{
                'Content-Type':'application/json'
            },
            body:JSON.stringify(up),
            });
            const result=await response.json();
            if (response.ok){
                console.log("success")
            }else{
                alert(result.error);
            }
        }catch(err){
            console.error('E-E-ERROR! ',err);
            alert('An Error Occured While Inserting The Record.');
        }
        }
        }else{
            alert("Please input what to update.");
        }
        }
    }
        
    }

    
        async function insertRes(){
            const ID=document.getElementById('resID');
            const rescID = document.getElementById('username');
            const rescName = document.getElementById('fullname');
            const resPax=document.getElementById('pax');
            const resCax=document.getElementById('cax');
            const resRoomName=document.getElementById('selRoom');
            let roomName
            if(arrayFlag!=0){
                roomName=arrayR
            }else{
                roomName=resRoomName.options[resRoomName.selectedIndex].textContent
            }
            const resCheckinDate=document.getElementById('check-in');
            const resCheckoutDate=document.getElementById('check-out')
            const resTour=document.getElementById('selTour');
            const resPayMeth=document.getElementById('selPayMeth');
            const rescEmail=document.getElementById('email');
            const rescphono=document.getElementById('phono');
            const resBookeDate=document.getElementById('book-in');
            const resPrice=document.getElementById("price");
            const resPromo=document.getElementById('selPromo')
        const datum={
            resID:ID.value,
            resmID:rescID.value,
            resmName:rescName.value,
            resmEmail:rescEmail.value,
            resmPhono:rescphono.value,
            resPax:resPax.value,
            resCax:resCax.value,
            resRoomName:roomName,
            resCheckinDate:resCheckinDate.value,
            resCheckoutDate:resCheckoutDate.value,
            resBookeDate:resBookeDate.value,
            resTour:resTour.value,
            resPrice:resPrice.value,
            resPromo:resPromo.value,
            resPayMeth:resPayMeth.value,
            resPayStat:payPicked,
            resStat:"Reserved"
        }
        try{
            const response = await fetch('/insertRes',{
            method:'POST',
            headers:{
                'Content-Type':'application/json'
            },
            body:JSON.stringify(datum),
            });
            const result=await response.json();
            if (response.ok){
                if(payGo==1){
                    await updateRoom()
                    await addCurrentRes()
                    alert("Thank you for making your reservation at Tubigan Garden Resort!");
                }else{
                    await updateRoom()
                    alert("Thank you for making your reservation at Tubigan Garden Resort!");
                    window.location.replace("UserPage.html")
                }
            }else{
                document.getElementById('inProgInd').hidden=true;
                alert(result.error);
            }
            
        }catch(err){
            console.error('E-E-ERROR! ',err);
            alert('An Error Occured While Inserting The Record.');
        }
            }

    async function notifier(){
            const sms=`Customer ${document.getElementById('fullname').value} with the Phone Number ${document.getElementById('phono').value} has made a reservation today. Please verify their payment.`
            try{
                const response=await fetch('/send-notification',{
                   method:'POST', 
                   headers: {
        'Content-Type': 'application/json',
      },
                   body:JSON.stringify({sms}),
                });
                const result = await response.json();
                if(response.ok){
                    console.log(result);
                }
            }catch(error){
                console.log(error)
            }
        }

        async function notifierCust(){
            const sms=`Customer ${document.getElementById('fullname').value}, please email Tubigan Garden Resort a photograph of the GCash Receipt as proof of your transaction using the email, tubiganresort2014@gmail.com.`
            const sendo=document.getElementById('email').value
            const datum={
                paymentGate:sms,
                customer:sendo
            }
            try{
                const response=await fetch('/send-notificationCust',{
                   method:'POST', 
                   headers: {
        'Content-Type': 'application/json',
      },
                   body:JSON.stringify(datum),
                });
                const result = await response.json();
                if(response.ok){
                    console.log(result);
                }
            }catch(error){
                console.log(error)
            }
        }

            async function addCurrentRes(){
            const ID=document.getElementById('resID')
            const next={
                        resID:ID.value
                    }
                    try{
                        const response=await fetch('/applyCurrentRes',{
                        method:'POST',
                        headers:{
                            'Content-Type':'application/json'
                        },
                        body:JSON.stringify(next)
                    })
                    if(response.ok){
                        window.location.replace("paymentGate.html")
                    }
                    }catch(err){
                        console.log(err)
                    }
        }
    </script>

    
    <footer>
        <p>&copy; (2014) Tubigan Garden Resort</p>
    </footer>
</body>
</html>
