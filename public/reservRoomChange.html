<html>
<head>
    <style>
        body, h1, h2, p {
   margin: 0;
   padding: 0;
}
       body {
   font-family: Arial, sans-serif;
   background-image: url('media/tubigan.jpg'); 
   background-repeat: no-repeat;
   background-size: cover;
   background-attachment: fixed;
   background-size: cover; 
   background-position: center;
   background-repeat: no-repeat; 
   margin: 0; 
   padding: 0;
   }

   header.style1 {
         display: flex;
         background-color: #007BFF;
         color: #fff;
         text-align: center;
         padding: 5px ;
         
       }
   div.styleRyle {
       padding: 75px 0px 0px 355px;
   }
       header.style1 a {
        display: inline-block;
        background-color: #fff;
        color: #007BFF;
        padding: 10px 150px;
        text-decoration: none;
        border-radius: 5px;
        margin-top: 20px;
        font-weight: bold;
       }
       header.style2 {
          background-color: #7cafc9;
          color: #fff;
         text-align: center;
         padding: 5px ;
       }
       header.style2 a {
        display: inline-block;
        background-color: #fff;
        color: #007BFF;
        padding: 10px 20px;
        text-decoration: none;
        border-radius: 5px;
        margin-top: 20px;
        font-weight: bold;
       }
       
   header.style2 nav{
         display: flex;
         justify-content: center;
         align-items: center;
       }
       header.style2 nav a{
           display: inline-block;
         padding: 10px 20px;
         text-decoration: none;
         color: #ff0202;
         background-color: rgb(226, 226, 83);
         border-radius: 35px;
         margin: 0 10px;
         transition: cubic-bezier(0.075, 0.82, 0.165, 1);
       }
       header.style2 nav a:hover{
         background-color: #007BFF;

       }
       header > img {
       height: 200px;
       width: 250px; 
       margin-right: 25px;}

   footer {
        text-align: center;
        background-color: #333;
        color: #fff;
        padding: 0px ;
        margin-top: 200px;
       }

       .btn {
           padding: 10px 30px;
           background-color: #007bff;
           color: #fff;
           text-decoration: none;
           border: none;
           border-radius: 5px;
           font-size: 16px;
           cursor: pointer;
       }
   .register-container {
           background-color: #fff;
           border-radius: 18px;
           padding: 45px;
           margin-top: 90px;
           margin-left: 475px;
           box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
           width: 300px;
       }

       .register-container h2 {
           text-align: center;
           margin-bottom: 20px;
       }

       .form-group {
           margin-bottom: 15px;
       }

       .form-group label {
           display: block;
           margin-bottom: 5px;
       }
       .form-group option{
           width: 100%;
           padding: 10px;
           border: 1px solid #ccc;
           border-radius: 4px;
       }

       .form-group input {
           width: 100%;
           padding: 10px;
           border: 1px solid #ccc;
           border-radius: 4px;
       }
       .notinput {
            border-color:transparent;
            background-color: transparent;
            margin-bottom: 15px;
            border-radius: 4px;
       }

       .bn632-hover {
 width: 160px;
 font-size: 16px;
 font-weight: 600;
 color: #fff;
 cursor: pointer;
 margin: 20px;
 height: 55px;
 text-align:center;
 border: none;
 background-size: 300% 100%;
 border-radius: 50px;
 moz-transition: all .4s ease-in-out;
 -o-transition: all .4s ease-in-out;
 -webkit-transition: all .4s ease-in-out;
 transition: all .4s ease-in-out;
}

.bn632-hover:hover {
 background-position: 100% 0;
 moz-transition: all .4s ease-in-out;
 -o-transition: all .4s ease-in-out;
 -webkit-transition: all .4s ease-in-out;
 transition: all .4s ease-in-out;
}

.bn632-hover:focus {
 outline: none;
}

.bn632-hover.bn26 {
 background-image: linear-gradient(
   to right,
   #25aae1,
   #4481eb,
   #04befe,
   #3f86ed
 );
 box-shadow: 0 4px 15px 0 rgba(65, 132, 234, 0.75);
}

       body {
           font-family: Arial, sans-serif;
       }
       .container {
           max-width: 600px;
           margin: 0 auto;
           padding: 0px;
           border-radius: 0px;
           backdrop-filter: blur(100%); 
           background-color: rgba(233, 230, 230, 0.8);
           box-shadow: 0 60px 80px rgba(0, 0, 0, 0.1);
           opacity: 100%;
       }
       h1 {
           text-align: center;
       }
       form {
           border: 1px solid #ccc;
           padding: 20px;
           margin-top: 20px;
           
       }
       
       input, 
       select{
           width: 95%;
           padding: 10px;
           margin-bottom: 15px;
           border: 1px solid #ccc;
           border-radius: 4px;
           
       }
       .smol{
           width: 15%;
           margin-bottom: 15px;
           border: 1px solid #ccc;
           border-radius: 4px;
       }
       .smolNoInput{
           width: 10%;
           margin-bottom: 15px;
           border-radius: 4px;
           border-color:transparent;
            background-color: transparent;
       }
       table {
           width: 100%;
           border-collapse: collapse;
           margin-top: 20px;
       }
       table, th, td {
           border: 1px solid #ccc;
       }
       th, td {
           padding: 10px;
           text-align: left;
       }
       th {
           background-color: #f2f2f2;
       }
       label {
            display: block;
            margin-bottom: 5px;
        }
        @keyframes fadeIn {
    0% { opacity: 0; }
    100% { opacity: 1; }
}

@keyframes fadeOut {
    0% { opacity: 1; }
    100% { opacity: 0; }
}

.fade-element {
    width: 80%;
    padding: 10px;
    margin-bottom: 15px;
    border: 5px solid #008cff;
    border-radius: 4px;
    opacity: 0; /* Start with fully transparent */
    transition: opacity 1s ease-in-out; /* Duration, timing function, and fill-mode */
}
.fade-in {
    animation: fadeIn 0.5s ease-in-out forwards;
}

.fade-out{
    animation: fadeOut 0.5s ease-in-out forwards;
}
</style>
</head>
<body>
    <header class="style1">
        <img src="media/5.png" alt="logo">
    <div class="styleRyle">
      
    </div>   
    </header>
    
    <header class="style2">
       <nav>  
    <header> 
        <a id="lnk1" href= "UserPage.html">Home</a>
        <a id="lnk2" href= "LogIn.html">Log Out</a>
        <a href= "Room.html">Rooms</a>
        <a href= "contacts.html">Contact Us</a>
    </nav> </header>
    <div class="container">
        <form id="fomres">
            <h1>Change Rooms</h1>
            <label>Reservation ID</label>
            <input class="notinput" id="resID" readonly>
            <label>Party Size <span style="color:transparent;user-select: none;">a</span> Children</label>
            <input id="pax" class="smol" type="number" value="1" min="0">
            <input id="cax" class="smol" type="number" value="0" min="0">
            <label>Old Chosen Rooms</label>
            <label id="roomArrayF"></label>
            <label>New Chosen Rooms</label>
            <label id="roomArray"></label>
            <img alt="now you see me" id="selRoomPic" hidden style="width:200px; height:200px;">
            <select id="selRoom">
                <option id="default" value=0>Loading. . .</option>
                <option>test</option>
                <!--you know what's up.-->
            </select>
            <button type="button" class="btn" onclick="more()">Add More</button>
            <button type="button" class="btn" id="arrayRem" onclick="reduce()">Reduce</button>
            <label id="e"></label>
            <label id="f"></label>
            <label>Price</label>
            <span>P</span><input class="notinput" type="number" id="fomPrice" value="0" min="0" readonly>
            <label id="runresPriceL" hidden>Additional Price</label>
            <span>P</span><input class="notinput" type="number" id="runresPriceF" hidden>
            <label>New Price</label>
            <span>P</span><input type="number" value="300.00" min="0" id="price" readonly>
            <label id="pricePlus"></label>
            <label>Book-In</label>
            <input class="notinput" type="date" id="bookin" readonly>
            <button type="button" onclick="appear()" id="shelfHandle">Expand</button>
            <div id="shelf" hidden="true" class="fade-element">
                <label>Check-In</label>
                <input class="notinput" type="date" id="checkin" readonly>
                <label>Check-Out</label>
                <input class="notinput" type="date" id="checkout" readonly>
                <input class="smolNoInput" type="number" id="daysaf" value="1" readonly><span> Nights</span>
            </div>
            <label>Chosen Tour</label>
            <input class="notinput" readonly id="resTour">
            <label>Payment Method</label>
            <select id="selPayMeth">
                <option value=""></option>
                <option value="GcashOL">Gcash - Online</option>
                <option value="GcashOS">Gcash - Onsite</option>
                <option value="Cash">Cash </option>
                <option value="WalkIn">Walk In</option>
            </select>
            <input  id="resPayStat" hidden>
            <input  id="resStat" hidden>
            <button class="btn" type="button" onclick="updateR()">Change</button>
            <span hidden id="inProgInd" hidden>Processing. Please wait. . .</span>
        </form>
    </div>
</body>
<script>
    //#region flashy shelf fades
    var hide=false;
function appear(){
    document.getElementById('shelf').hidden=false
    document.getElementById('shelf').classList.add('fade-in')
    document.getElementById('shelf').classList.remove('fade-out')
    document.getElementById('shelfHandle').onclick=function(){
        hide=true
        disappear()
    }
}
function disappear(){
    document.getElementById('shelf').classList.add('fade-out')
    document.getElementById('shelf').classList.remove('fade-in')
    document.getElementById('shelf').addEventListener('animationend',function(){
        if(hide){
            hide=false
        document.getElementById('shelf').hidden=true
        }
    },{ once: true });
    document.getElementById('shelfHandle').onclick=function(){
        appear()
    }
}
    //#endregion
    //#region array
    let arrayFlag=0,arrayL,indexSel
let arrayPrice=0
const arrayR=[]
const arrayI=[]
const arrayD=[]
const arrayIP=[]
function more(){
    document.getElementById('selRoomPic').hidden=true
    arrayR.push(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].textContent)
    arrayD.push({text:document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].textContent,index:arrayI.length})
    arrayI.push(arrayI.length)
    document.getElementById('roomArray').innerHTML=arrayD.map(item => 
    {
        if(payStatf.value=="Paid" || statf.value=="Checked In"){
            if(arrayIP[item.index]==item.index){
                return `${item.text}`
            }else{
                return `${item.text} <button class="btn" type="button" id="index${item.index}" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`
            }
        }else{
        return `${item.text} <button class="btn" type="button" id="index${item.index}" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`
    }
    }).join('<br>');
    var nuprice=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value)
    document.getElementById('selRoom').selectedIndex=0
    arrayPrice=parseFloat(arrayPrice)+nuprice
    arrayL=arrayR.length
    if(arrayL>1){
        arrayFlag=1
    }else if(arrayL<=1){
        arrayFlag=0
    }
    document.getElementById('e').innerHTML=`Total Price: ${arrayPrice} <br> ArrayCount: ${arrayL}<br>${arrayR}<br>${arrayI}<br>Selected Index: ${indexSel}<br>Flag? ${arrayFlag}`
    document.getElementById('f').innerHTML=arrayD.map(item =>`${item.text}- ${item.index}`).join('<br>')
    var x,y,z
    if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
    var disPrice=parseFloat((((x+y)+z)-y))+parseFloat(arrayPrice)
    document.getElementById('price').value=disPrice.toFixed(2)
    document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value}`
}

function selectIndex(index){
    if (indexSel !== undefined) {
        document.getElementById(`index${indexSel}`).style.backgroundColor = "#007BFF";
    }
    if(indexSel==index){
    indexSel=undefined
    console.log("Selected: "+indexSel)
    document.getElementById('arrayRem').onclick=reduce
    }else{
        indexSel=index
    console.log("Selected: "+indexSel)
        document.getElementById(`index${index}`).style.backgroundColor="#eb2222"
        document.getElementById('arrayRem').onclick=deletArray
    }
}

function deletArray(){
    document.getElementById('selRoomPic').hidden=true
    console.log(indexSel)
    if(indexSel!=-1){
        arrayD.splice(indexSel,1);
        var a=arrayR.splice(indexSel,1)
        arrayI.pop();
        arrayL=arrayR.length
        for(let i=0; i<arrayD.length;i++){
            arrayD[i].index=i
        }
        const selA=document.getElementById('selRoom')
    for(let i=0; i<selA.options.length; i++){
        //alert(selA.options[i].text + " = "+ a)
                if(selA.options[i].text==a){
                    selA.selectedIndex=i
                    break;
                }
               }
               var nuprice=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value)
    arrayPrice=parseFloat(arrayPrice)-parseFloat(nuprice)
    //alert(arrayPrice)
    arrayL=arrayR.length
    if(arrayL>1){
        arrayFlag=1
    }else if(arrayL<=1){
        arrayFlag=0
    }
    document.getElementById('selRoom').selectedIndex=0
    document.getElementById('roomArray').innerHTML=arrayD.map(item => 
    {
        if(payStatf.value!="Unpaid" || statf.value=="Checked In"){
            if(arrayIP[item.index]==item.index){
                return `${item.text}`
            }else{
                return `${item.text} <button class="btn" type="button" id="index${item.index}" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`
            }
        }else{
        return `${item.text} <button class="btn" type="button" id="index${item.index}" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`
    }
    }).join('<br>');
        document.getElementById('e').innerHTML=`Total Price: ${arrayPrice} <br> ArrayCount: ${arrayL}<br>${arrayR}<br>${arrayI}<br>Selected Index: ${indexSel}<br>Flag? ${arrayFlag}`
        document.getElementById('f').innerHTML=arrayD.map(item =>`${item.text}- ${item.index}`).join('<br>')
        var x,y,z
    if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
           var disPrice=parseFloat((((x+y)+z)-y))+parseFloat(arrayPrice)
    document.getElementById('price').value=disPrice.toFixed(2)
    document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value}`
    indexSel=undefined
    document.getElementById('arrayRem').onclick=reduce
    }
    
}


function reduce(){
    document.getElementById('selRoomPic').hidden=true
    console.log(indexSel)
    if(arrayR.length===0){
        return
    }
    var a=arrayR.pop()
    arrayI.pop()
    arrayD.pop()
    document.getElementById('roomArray').innerHTML=arrayD.map(item => 
    {
        if(payStatf.value!="Unpaid" || statf.value=="Checked In"){
            if(arrayIP[item.index]==item.index){
                return `${item.text}`
            }else{
                return `${item.text} <button class="btn" type="button" id="index${item.index}" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`
            }
        }else{
        return `${item.text} <button class="btn" type="button" id="index${item.index}" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`
    }
    }).join('<br>');
    const selA=document.getElementById('selRoom')
    for(let i=0; i<selA.options.length; i++){
                if(selA.options[i].text===a){
                    selA.selectedIndex=i
                    break;
                }
               }
    var nuprice=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value)
    document.getElementById('selRoom').selectedIndex=0
    arrayPrice=parseFloat(arrayPrice)-nuprice
    arrayL=arrayR.length
    if(arrayL>1){
        arrayFlag=1
    }else if(arrayL<=1){
        arrayFlag=0
    }
    document.getElementById('e').innerHTML=`Total Price: ${arrayPrice} <br> ArrayCount: ${arrayL}<br>${arrayR}<br>${arrayI}<br>Selected Index: ${indexSel}<br>Flag? ${arrayFlag}`
    document.getElementById('f').innerHTML=arrayD.map(item =>`${item.text}- ${item.index}`).join('<br>')
    var x,y,z
    if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
           var disPrice=parseFloat((((x+y)+z)-y))+parseFloat(arrayPrice)
    document.getElementById('price').value=disPrice.toFixed(2)
    document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value}`
    }
    //#endregion

//#region how am I supposed to reserve a room without PICTURES???

document.getElementById('selRoom').addEventListener('change', async function() {
    let room=document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].textContent
    console.log(room)
    try {
        const response = await fetch('/room-data');
        const result = await response.json();
        if (response.ok) {
            for(let item of result){
                let roomName=item.roomName
                console.log(roomName)
                if(room==roomName){
                    document.getElementById('selRoomPic').hidden=false
    document.getElementById('selRoomPic').src=item.roomImg
                }
            }
        }}
    catch(err) {
        console.error('Error:', err);
    }
    //it grabs the appropriate picture's url from the database and slaps it onto the img's src.
})

//#endregion

    //#region price manipulator
document.getElementById('selRoom').addEventListener('change', function() {
        const selectedOption = parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           const price=document.getElementById('price');
           var x,y;
           if(arrayL==undefined || arrayL==0){
            if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
           } 
           var nuPrice=((x+selectedOption)-y)+arrayPrice;
           price.value=nuPrice.toFixed(2);
           if (document.getElementById('selRoom').value==""){
            price.value="300"
           }
           }else{
            if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
           } 
           var nuPrice=((((x+y)+z)-y))+arrayPrice;
           price.value=nuPrice.toFixed(2);
           document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value}`
           if (document.getElementById('selRoom').value==""){
            document.getElementById('pricePlus').textContent="0"
           }
           }
        });

        document.getElementById('pax').addEventListener('change',function(){
            if(document.getElementById('pax').value <=0){
                document.getElementById('pax').value=1
            }
            const priceText=document.getElementById('price');
            var x,y,z;
            if(arrayL==undefined || arrayL==0){
                if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } 
            var nuPrice=(((x+y)+z)-y)+arrayPrice;
           priceText.value=nuPrice.toFixed(2);
           
            }else{
                //if array is 1, cuz there's gonna be more
                if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           }
            var nuPrice=(((x+y)+z)-y)+arrayPrice;
           priceText.value=nuPrice.toFixed(2);
           document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value}`
           
            }
        });

        document.getElementById('cax').addEventListener('change',function(){
            if( document.getElementById('cax').value <=0){
                document.getElementById('cax').value=0
            }
            const priceText=document.getElementById('price');
            var x,y,z;
            if(arrayL==undefined || arrayL==0){
                if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
            z=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value);
           } 
           
            var nuPrice=(((x+y)+z)-y)+arrayPrice;
           priceText.value=nuPrice.toFixed(2);
           
            }else{
                //arrayCount is 1, and there's gonna be more
                if(document.getElementById('pax').value=="" && document.getElementById('cax').value==""){
            x=300;
            y=0;
           } else if(document.getElementById('pax').value!="" && document.getElementById('cax').value==""){
            x=300*parseFloat(document.getElementById('pax').value)
            y=0
           } else if(document.getElementById('pax').value=="" && document.getElementById('cax').value!=""){
            x=300
            y=300*parseFloat(document.getElementById('cax').value)
           }
           else {
            x=300*parseFloat(document.getElementById('pax').value)
            y=300*parseFloat(document.getElementById('cax').value)
           }
           console.log(x+"+"+y+"+"+arrayPrice+"-"+y)
            var nuPrice=((x+y)+arrayPrice)-y;
           priceText.value=nuPrice.toFixed(2);
           document.getElementById('pricePlus').textContent=`+ ${document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value}`
           
            }
        });;
    //#endregion
    //#region data fill-er-uppers
    const IDf=document.getElementById('resID')
    const paxf=document.getElementById('pax')
    const caxf=document.getElementById('cax')
    const roomsf=document.getElementById('selRoom')
    const pricef=document.getElementById('fomPrice')
    const priceAL=document.getElementById('runresPriceL')
    const priceA=document.getElementById('runresPriceF')
    const priceN=document.getElementById('price')
    const checkI=document.getElementById('checkin')
    const checkO=document.getElementById('checkout')
    const bookI=document.getElementById('bookin')
    const tourf=document.getElementById('resTour')
    const pMethf=document.getElementById('selPayMeth')
    const dayzf=document.getElementById('daysaf')
    const statf=document.getElementById('resStat')
    const payStatf=document.getElementById('resPayStat')
    fetch('/room-data')
            .then(response => {
                if (response.ok) {
                    return response.json(); 
                } else {
                    throw new Error('Error fetching data');
                }
            })
            .then(data => {
                const selectElement = document.getElementById('selRoom');
                document.getElementById('default').textContent = "";
                data.forEach(item => {
                    if(item.roomReservd!="Unavailable"){
                        const option = document.createElement('option');
                    option.value = item.roomCost; 
                    option.textContent = item.roomName; 
                    selectElement.appendChild(option);
                    }
                });
                return searchR()
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
//#endregion
    //#region days away from checkin to bookin
document.getElementById('selPayMeth').addEventListener('change',function(){
    
if(document.getElementById('selPayMeth').options[document.getElementById('selPayMeth').selectedIndex].value=="WalkIn"){
    document.getElementById('bookin').valueAsDate=document.getElementById('checkin').valueAsDate
}else{
    const checked=new Date(document.getElementById('checkin').value)
    checked.setDate(checked.getDate()-1)
    document.getElementById('bookin').valueAsDate=checked
}
})
//#endregion

        let runBalID
async function searchR(){
        try{
            const response=await fetch('/current_reservation')
            const result=await response.json()
            if(response.ok){
                const response2=await fetch(`/searchRunRes?runresID=${result.resID}`)
                const result2=await response2.json()
                if(response2.ok){
                    runBalID=result2.runID
                    priceAL.hidden=false
                    priceA.hidden=false
                    priceA.value=result2.runresBal
                }
                IDf.value=result.resID
                paxf.value=result.resPax
                caxf.value=result.resCax
                if(Array.isArray(result.resRoomName)){
                    for(let e=0;e<result.resRoomName.length;e++){
                        const selF=result.resRoomName[e]
                        for(let i=0;i<roomsf.options.length;i++){
                            if(roomsf.options[i].text==selF){
                                roomsf.selectedIndex=i
                                arrayR.push(selF)
                                arrayD.push({text:selF,index:arrayI.length})
                                arrayI.push(arrayI.length)
                                arrayIP.push(arrayIP.length)
                                arrayL=arrayR.length
                                if(arrayL>1){
                                arrayFlag=1
                                }else if(arrayL<=1){
                                arrayFlag=0
                                }
                                var nuprice=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value)
                    arrayPrice=parseFloat(arrayPrice)+nuprice
                    if(result.resPayStat=="Unpaid" || result.resStat!="Checked In"){
                    document.getElementById('roomArray').innerHTML=arrayD.map(item => `${item.text} <button class="btn" type="button" id="index${item.index}" onclick="selectIndex(${item.index})">Select Item No. ${item.index}</button>`).join('<br>');
                    document.getElementById('e').innerHTML=`Total Price: ${arrayPrice} <br> ArrayCount: ${arrayL}<br>${arrayR}<br>${arrayI}<br>Selected Index: ${indexSel}<br>Flag? ${arrayFlag}`
                    document.getElementById('f').innerHTML=arrayD.map(item =>`${item.text}- ${item.index}`).join('<br>')
                    }
                    else
                    {
                    document.getElementById('roomArray').innerHTML=arrayD.map(item => `${item.text}`).join('<br>');
                    document.getElementById('e').innerHTML=`Total Price: ${arrayPrice} <br> ArrayCount: ${arrayL}<br>${arrayR}<br>${arrayI}<br>Selected Index: ${indexSel}<br>Flag? ${arrayFlag}`
                    document.getElementById('f').innerHTML=arrayD.map(item =>`${item.text}- ${item.index}`).join('<br>')
                    }
                    document.getElementById('selRoom').selectedIndex=0
                    
                                break;
                            }
                        }
                    }
                }else{
                    const selF=result.resRoomName
                    for(let i=0;i<roomsf.options.length;i++){
                            if(roomsf.options[i].text==selF){
                                roomsf.selectedIndex=i
                                if(result.resStat=="Checked In" || result.resPayStat!="Unpaid"){
                                arrayR.push(selF)
                                arrayD.push({text:selF,index:arrayI.length})
                                arrayI.push(arrayI.length)
                                arrayIP.push(arrayIP.length)
                                arrayL=arrayR.length
                    document.getElementById('roomArray').innerHTML=arrayD.map(item => `${item.text}`).join('<br>');
                    var nuprice=parseFloat(document.getElementById('selRoom').options[document.getElementById('selRoom').selectedIndex].value)
                    arrayPrice=parseFloat(arrayPrice)+nuprice
                    document.getElementById('e').innerHTML=`Total Price: ${arrayPrice} <br> ArrayCount: ${arrayL}<br>${arrayR}<br>${arrayI}<br>Selected Index: ${indexSel}<br>Flag? ${arrayFlag}`
                    document.getElementById('f').innerHTML=arrayD.map(item =>`${item.text}- ${item.index}`).join('<br>')
                    document.getElementById('selRoom').selectedIndex=0
                                }
                                break;
                        }
                    }
                }

                pricef.value=result.resPrice
                checkI.value=result.resCheckinDate
                checkO.value=result.resCheckoutDate
                const checkD1=new Date(checkI.value)
                const checkD2=new Date(checkO.value)
                const checkE=Math.floor((checkD2-checkD1) / (1000 * 60 * 60 * 24))
                dayzf.value=checkE
                bookI.value=result.resBookeDate
                tourf.value=result.resTour
                pMethf.value=result.resPayMeth
                statf.value=result.resStat
                payStatf.value=result.resPayStat
                console.log(result.resRoomName)
            }else{
                return window.location.replace('LogIn.html')
            }
        }catch(err){
            console.error("Error looking through the Database. ",err);
            alert('someone tripped over the wires!');
        }
       }

       let runBalFlag
       async function updateR(){
        document.getElementById('inProgInd').hidden=false;
            const resID=document.getElementById('resID').value
            let resmIDf,resmNamef,resPaxf,resCaxf,resmEmailf,resmPhonof,resRoomNamef,resCheckinDatef,resCheckoutDatef,resBookeDatef,resTourf,resPricef,resPromof,resPayMethf,resPayStatf,resStatf
            try{
                const response=await fetch(`/searchRes?resID=${resID}`)
                const result=await response.json();
                if(response.ok){
                    resmIDf=result.resmID
                    resmNamef=result.resmName
                    resmEmailf=result.resmEmail
                    resmPhonof=result.resmPhono
                    resPaxf=result.resPax
                    resCaxf=result.resCax
                    resRoomNamef=result.resRoomName
                    resCheckinDatef=result.resCheckinDate
                    resCheckoutDatef=result.resCheckoutDate
                    resBookeDatef=result.resBookeDate
                    resTourf=result.resTour
                    resPricef=result.resPrice
                    resPromof=result.resPromo
                    resPayMethf=result.resPayMeth
                    resPayStatf=result.resPayStat
                    resStatf=result.resStat
                }
            }catch(err){
                console.log('ERROR ',err)
                alert('An Error Occured While Inserting The Record.');
            }
            if(arrayFlag!=0){
                if(resRoomNamef!=arrayR){
                    resRoomNamef=arrayR
                }
            }else{
                if(arrayL==1){
                    if(resRoomNamef!=arrayR[0]){
                        resRoomNamef=arrayR[0]
                    }
                }else{
                    if(resRoomNamef!=roomsf.options[roomsf.selectedIndex].text){
                        resRoomNamef=roomsf.options[roomsf.selectedIndex].text
                    }   
                }
            }
            if(resPaxf!=paxf.value){
                resPaxf=paxf.value
            }
            if(resCaxf!=caxf.value){
                resCaxf=caxf.value
            }
            if(resPricef!=priceN.value){
                if(priceN.value % 300 == 0.00){
                        resPricef=priceN.value                    
                }
            }
            if(resPayMethf!=pMethf.value){
                resPayMethf=pMethf.value
            }
            const updoot={
                resID:resID,
                resmID:resmIDf,
                resmName:resmNamef,
                resmEmail:resmEmailf,
                resmPhono:resmPhonof,
                resPax:resPaxf,
                resCax:resCaxf,
                resRoomName:resRoomNamef,
                resCheckinDate:resCheckinDatef,
                resCheckoutDate:resCheckoutDatef,
                resBookeDate:resBookeDatef,
                resTour:resTourf,
                resPrice:resPricef,
                resPromo:resPromof,
                resPayMeth:resPayMethf,
                resPayStat:resPayStatf,
                resStat:resStatf
            }
            try{
            const response = await fetch('/updateRes',{
            method:'PATCH',
            headers:{
                'Content-Type':'application/json'
            },
            body:JSON.stringify(updoot),
            });
            const result=await response.json();
            if (response.ok){
                if(statf.value=="Checked In" || payStatf.value=="Paid"){
                    await insertRun()
                }else if(payStatf.value=="Half Paid"){
                   await updateRun()
                }
                window.location.replace("UserPage.html")
            }else{
                alert(result.error);
            }
            }catch(err){
            console.error('E-E-ERROR! ',err);
            alert('An Error Occured While Inserting The Record.');
            }
        }

    async function insertRun(){
        const rng=Math.floor(Math.random()*10);
        const rng2=Math.floor(Math.random()*10);
        const rng3=Math.floor(Math.random()*10);
        const rng4=Math.floor(Math.random()*10);
        const runID=IDf.value[0]+IDf.value[1]+"-RunBal-"+rng+rng2+rng3+rng4
        const datum={
            runID:runID,
            runresID:IDf.value,
            runresPrice:priceN.value-pricef.value,
            runresBal:priceN.value-pricef.value,
            runresStat:"Unpaid"
        }
        try{
            const response = await fetch('/insertRun',{
            method:'POST',
            headers:{
                'Content-Type':'application/json'
            },
            body:JSON.stringify(datum),
            });
            const result=await response.json()
            if(response.ok){
                alert("You now have a running balance. Please pay this off on or before your visit.")
            }
        }catch(err){
            console.error('E-E-ERROR! ',err);
            alert('An Error Occured While Inserting The Record.');
        }
    }

    let runresIDf,runresPricef,runresBalf,runresStatf,runbalPaidFlag=0, runTrigger
        async function updateRun(){
            const response=await fetch(`/searchRun?runID=${runBalID}`)
            const result=await response.json()
            if(response.ok){
                runresIDf=result.runresID
                runresPricef=result.runresPrice
                runresBalf=result.runresBal
                runresStatf=result.runresStat
                const datum={
                runID:runBalID,
                runresID:runresIDf,
                runresPrice:parseFloat(runresPricef)+parseFloat(priceN.value),
                runresBal:parseFloat(runresBalf)+parseFloat(priceN.value),
                runresStat:runresStatf
            }
            try{
                const response=await fetch('/updateRun',{
                    method:'POST',
                    headers:{
                'Content-Type':'application/json'
            },
                    body:JSON.stringify(datum),
                })
                const result=await response.json()
                if(response.ok){
                    console.log(nice)
                }else{
                    alert(result.error);
                }}catch(err){
                    console.error('E-E-ERROR! ',err);
                }
            }
            }
</script>
</html>